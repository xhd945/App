//
//  CommonMethods.m
//  occ
//
//  Created by zhangss on 13-8-29.
//  Copyright (c) 2013å¹´ RS. All rights reserved.
//

#import "OCCWaitingView.h"
#import "GoodsFilterViewController.h"
#import "GoodsFilterLeftViewController.h"
#import "LoginViewController.h"
#import "ShopViewController.h"
#import "AppDelegate.h"
#import "OCCAlertView.h"
#import <sys/utsname.h>
#import "Reachability.h"

@implementation CommonMethods

#pragma mark -
#pragma mark Navi Buttons
+ (UIView *)leftNavigationButtonWithHomeTarget:(id)target andSelector:(SEL)backSel andHomeSelector:(SEL)homeSel andBackTitle:(NSString *)titleStr
{
    UIView *leftNaviView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, SCREEN_WIDTH, HEADER_HEIGHT)];
    
    UIButton *backButton = [[UIButton alloc]init];
    UIImage *leftImage = [UIImage imageNamed:@"btn_bg_returnleft.png"];
    UIImage *streachImage = [leftImage stretchableImageWithLeftCapWidth:44.0 topCapHeight:44.0];
    [backButton setBackgroundImage:streachImage forState:UIControlStateNormal];
    [backButton addTarget:target action:backSel forControlEvents:UIControlEventTouchUpInside];
    backButton.titleLabel.font = FONT_14;
    [backButton setTitleColor:COLOR_333333 forState:UIControlStateNormal];
    [backButton setTitle:titleStr forState:UIControlStateNormal];
    [backButton setTitleEdgeInsets:UIEdgeInsetsMake(0,12,0,0)];
    CGSize textSize = [titleStr sizeWithFont:backButton.titleLabel.font];
    [backButton setFrame:CGRectMake(10, 0, textSize.width + 25, HEADER_HEIGHT)];
    
    [leftNaviView addSubview:backButton];
    
    UIButton *homeButton = [[UIButton alloc]init];
    [homeButton setFrame:CGRectMake(backButton.frame.origin.x+backButton.frame.size.width, 0, HEADER_HEIGHT, HEADER_HEIGHT)];
    [homeButton setBackgroundImage:[UIImage imageNamed:@"btn_bg_home.png"] forState:UIControlStateNormal];
    [homeButton setImage:[UIImage imageNamed:@"btn_home.png"] forState:UIControlStateNormal];
    [homeButton addTarget:target action:homeSel forControlEvents:UIControlEventTouchUpInside];
    homeButton.titleLabel.font = FONT_14;
    [homeButton setTitleColor:[UIColor whiteColor] forState:UIControlStateNormal];
    [homeButton setImageEdgeInsets:UIEdgeInsetsMake(0,-15,0,0)];
    [leftNaviView addSubview:homeButton];
    leftNaviView.frame = CGRectMake(0, 0, homeButton.frame.origin.x + homeButton.frame.size.width, HEADER_HEIGHT);
    return leftNaviView;
}

+ (UIView *)navigationViewWithType:(OCCNavigationType)navigationType
{
    UIImageView *topImageView = [[UIImageView alloc]init];
    topImageView.userInteractionEnabled = YES;
    topImageView.backgroundColor = [UIColor blackColor];
    [topImageView setFrame:CGRectMake(0, 0, SCREEN_WIDTH, HEADER_HEIGHT)];
    if (navigationType == OCCNavigationTypeClassOne)
    {
        [topImageView setImage:[UIImage imageNamed:@"navi_bg_classOne"]];
    }
    else if (navigationType == OCCNavigationTypeClassOne)
    {
        [topImageView setImage:[UIImage imageNamed:@"navi_bg_classTwo"]];
    }
    else if (navigationType == OCCNavigationTypeClassThree)
    {
        [topImageView setImage:[UIImage imageNamed:@"navi_bg_classTwo"]];
    }
    
    return topImageView;
}

+ (UIView *)backNavigationButtonWithTarget:(id)target andSelector:(SEL)selector
{
    return [CommonMethods backNavigationButtonWithTarget:target andSelector:selector withNavigationType:OCCNavigationTypeClassOne];
}

+ (UIView *)backNavigationButtonWithTarget:(id)target andSelector:(SEL)selector withNavigationType:(OCCNavigationType)type;
{
    UIButton *backButton = [[UIButton alloc]init];
    UIImage *bgImage = nil;
    if (type == OCCNavigationTypeClassOne)
    {
        bgImage = [UIImage imageNamed:@"navi_btn_bg"];
    }
    else 
    {
        bgImage = [UIImage imageNamed:@"navi_btn_bg_two"];
    }
    [backButton setFrame:CGRectMake(0, (HEADER_HEIGHT - bgImage.size.height)/2, bgImage.size.width, bgImage.size.height)];
    [backButton setBackgroundImage:bgImage forState:UIControlStateNormal];
    [backButton setImage:[UIImage imageNamed:@"navi_icon_back"] forState:UIControlStateNormal];
    [backButton addTarget:target action:selector forControlEvents:UIControlEventTouchUpInside];
    return backButton;
}

+ (UIView *)navigationButtonWithTarget:(id)target andSelector:(SEL)selector andButtonType:(OCCNavigationButtonType)buttonType andLeft:(BOOL)left
{
    NSString *imageName = nil;
    switch (buttonType)
    {
        case OCCNavigationButtonTypeAdd:
            imageName = @"navi_icon_add";
            break;
        case OCCNavigationButtonTypeCart:
            imageName = @"navi_icon_cart";
            break;
        case OCCNavigationButtonTypeCheck:
            imageName = @"navi_icon_check";
            break;
        case OCCNavigationButtonTypeEdit:
            imageName = @"navi_icon_edit";
            break;
        case OCCNavigationButtonTypeFavorite:
            imageName = @"navi_icon_favorite";
            break;
        case OCCNavigationButtonTypeFilter:
            imageName = @"navi_icon_filter";
            break;
        case OCCNavigationButtonTypeMore:
            imageName = @"navi_icon_more";
            break;
        case OCCNavigationButtonTypeShowLeft:
            imageName = @"navi_icon_showLeft";
            break;
        case OCCNavigationButtonTypeFilterLeft:
            imageName = @"navi_icon_filter_left";
            break;
        case OCCNavigationButtonTypeTwoCode:
            imageName = @"navi_icon_twocode";
            break;
        case OCCNavigationButtonTypeLocate:
            imageName = @"navi_icon_locate";
            break;
        case OCCNavigationButtonTypeMessage:
            imageName = @"icon_message_white";
            break;
        default:
            break;
    }
    
    UIButton *backButton = [[UIButton alloc]init];
    UIImage *bgImage = [UIImage imageNamed:@"navi_btn_bg"];
    if (left)
    {
        [backButton setFrame:CGRectMake(0, (HEADER_HEIGHT - bgImage.size.height)/2, bgImage.size.width, bgImage.size.height)];
    }
    else
    {
        [backButton setFrame:CGRectMake(SCREEN_WIDTH - bgImage.size.width, (HEADER_HEIGHT - bgImage.size.height)/2, bgImage.size.width, bgImage.size.height)];
    }
    [backButton setBackgroundImage:bgImage forState:UIControlStateNormal];
    [backButton setImage:[UIImage imageNamed:imageName] forState:UIControlStateNormal];
    [backButton addTarget:target action:selector forControlEvents:UIControlEventTouchUpInside];
    return backButton;
}

+ (UIView *)navigationButtonWithTitle:(NSString *)title WithTarget:(id)target andSelector:(SEL)selector andLeft:(BOOL)left
{    
    UIButton *naviBtn = [[UIButton alloc]init];

    UIImage *bgImage = [UIImage imageNamed:@"navi_btn_bg"];
    [naviBtn setBackgroundImage:[bgImage stretchableImageWithLeftCapWidth:bgImage.size.width/2 topCapHeight:bgImage.size.height/2] forState:UIControlStateNormal];
    [naviBtn setTitle:title forState:UIControlStateNormal];
    [naviBtn addTarget:target action:selector forControlEvents:UIControlEventTouchUpInside];
    [naviBtn setTitleColor:COLOR_FFFFFF forState:UIControlStateNormal];
    naviBtn.titleLabel.font = FONT_14;
    [naviBtn setTitleColor:COLOR_333333 forState:UIControlStateHighlighted];
    
    CGSize titleSize = [naviBtn.titleLabel.text sizeWithFont:naviBtn.titleLabel.font];
    if (left)
    {
        [naviBtn setFrame:CGRectMake(0, 0, titleSize.width + 20+20, HEADER_HEIGHT)];
    }
    else
    {
        [naviBtn setFrame:CGRectMake(SCREEN_WIDTH - titleSize.width - 20-20, 0, titleSize.width + 20+20, HEADER_HEIGHT)];
    }
    return naviBtn;
}

+ (UIView *)toolBarButtonWithTarget:(id)target andSelector:(SEL)selector andButtonType:(OCCToolBarButtonType)type andLeft:(BOOL)left
{
    NSString *imageName = nil;
    switch (type)
    {
        case OCCToolBarButtonTypeAdd:
            imageName = @"tool_icon_add";
            break;
        case OCCToolBarButtonTypeBack:
            imageName = @"navi_icon_back";
            break;
        case OCCToolBarButtonTypeEmoji:
            imageName = @"tool_icon_emoji";
            break;
        case OCCToolBarButtonTypeGird:
            imageName = @"tool_icon_gird";
            break;
        case OCCToolBarButtonTypeKeyboard:
            imageName = @"tool_icon_keyboard";
            break;
        case OCCToolBarButtonTypeList:
            imageName = @"tool_icon_list";
            break;
        case OCCToolBarButtonTypeCart:
            imageName = @"navi_icon_cart";
            break;
        case OCCToolBarButtonTypeCheck:
            imageName = @"navi_icon_check";
            break;
        case OCCToolBarButtonTypeShare:
            imageName = @"navi_icon_share";
            break;
        default:
            break;
    }
    
    UIButton *backButton = [[UIButton alloc]init];
    UIImage *bgImage = [UIImage imageNamed:@"navi_btn_bg"];
    if (left)
    {
        [backButton setFrame:CGRectMake(0, (HEADER_HEIGHT - bgImage.size.height)/2, bgImage.size.width, bgImage.size.height)];
    }
    else
    {
        [backButton setFrame:CGRectMake(SCREEN_WIDTH - bgImage.size.width, (HEADER_HEIGHT - bgImage.size.height)/2, bgImage.size.width, bgImage.size.height)];
    }

    [backButton setBackgroundImage:[UIImage imageNamed:@"tool_btn_bg"] forState:UIControlStateNormal];
    [backButton setImage:[UIImage imageNamed:imageName] forState:UIControlStateNormal];
    [backButton addTarget:target action:selector forControlEvents:UIControlEventTouchUpInside];
    return backButton;
}

+ (UIView *)toolBarButtonWithTitle:(NSString *)title WithTarget:(id)target andSelector:(SEL)selector andLeft:(BOOL)left
{
    UIButton *naviBtn = [[UIButton alloc]init];
    
    UIImage *bgImage = [UIImage imageNamed:@"tool_btn_bg"];
    [naviBtn setBackgroundImage:[bgImage stretchableImageWithLeftCapWidth:bgImage.size.width/2 topCapHeight:bgImage.size.height/2] forState:UIControlStateNormal];
    [naviBtn setTitle:title forState:UIControlStateNormal];
    //[naviBtn setTitleColor:COLOR_FFFFFF forState:UIControlStateHighlighted];
    [naviBtn addTarget:target action:selector forControlEvents:UIControlEventTouchUpInside];
    [naviBtn setTitleColor:COLOR_FFFFFF forState:UIControlStateNormal];
    [naviBtn setTitleColor:COLOR_999999 forState:UIControlStateDisabled];
    naviBtn.titleLabel.font = FONT_14;
    
    CGSize titleSize = [naviBtn.titleLabel.text sizeWithFont:naviBtn.titleLabel.font];
    if (left)
    {
        [naviBtn setFrame:CGRectMake(5, 0, titleSize.width + 30, HEADER_HEIGHT)];
    }
    else
    {
        [naviBtn setFrame:CGRectMake(SCREEN_WIDTH - titleSize.width - 30 - 5, 0, titleSize.width + 30, HEADER_HEIGHT)];
    }
    return naviBtn;
}

//æé®
+ (UIView *)buttonWithTitle:(NSString *)title withTarget:(id)target andSelector:(SEL)selector andFrame:(CGRect)rect andButtonType:(OCCButtonType)type
{
    UIButton *btn = [[UIButton alloc]initWithFrame:rect];
    
    NSString *imageName = nil;
    UIColor *color=nil;
    switch (type)
    {
        case OCCButtonTypeGreen:
            imageName = @"btn_bg_green";
            color=COLOR_FFFFFF;
            break;
        case OCCButtonTypeYellow:
            imageName = @"btn_bg_yellow";
            color=COLOR_FFFFFF;
            break;
        case OCCButtonTypeWhite:
            imageName = @"btn_bg_white";
            color=COLOR_FFFFFF;
            break;
        case OCCButtonTypeLightGray:
            imageName = @"btn_bg_light_gray";
            color=COLOR_000000;
            break;
        case OCCButtonTypeGray:
            imageName = @"btn_bg_gray";
            color=COLOR_000000;
            break;
        case OCCButtonTypeRed:
            imageName = @"btn_bg_red";
            color=COLOR_FFFFFF;
            break;
        default:
            color=COLOR_FFFFFF;
            break;
    }
    
    UIImage *bgImage = [UIImage imageNamed:imageName];
    [btn setBackgroundImage:[bgImage stretchableImageWithLeftCapWidth:bgImage.size.width/2 topCapHeight:bgImage.size.height/2] forState:UIControlStateNormal];
    [btn setTitle:title forState:UIControlStateNormal];
    [btn addTarget:target action:selector forControlEvents:UIControlEventTouchUpInside];
    [btn setTitleColor:color forState:UIControlStateNormal];
    [btn setTitleColor:color forState:UIControlStateHighlighted];
    btn.titleLabel.font = FONT_14;
    return btn;
}

+ (UIView *)buttonWithImage:(NSString *)image withTarget:(id)target andSelector:(SEL)selector andFrame:(CGRect)rect andButtonType:(OCCButtonType)type
{
    UIButton *btn = [[UIButton alloc]initWithFrame:rect];
    
    NSString *imageName = nil;
    UIColor *color=nil;
    switch (type)
    {
        case OCCButtonTypeGreen:
            imageName = @"btn_bg_green";
            color=COLOR_FFFFFF;
            break;
        case OCCButtonTypeYellow:
            imageName = @"btn_bg_yellow";
            color=COLOR_FFFFFF;
            break;
        case OCCButtonTypeWhite:
            imageName = @"btn_bg_white";
            color=COLOR_FFFFFF;
            break;
        case OCCButtonTypeLightGray:
            imageName = @"btn_bg_light_gray";
            color=COLOR_000000;
            break;
        case OCCButtonTypeGray:
            imageName = @"btn_bg_gray";
            color=COLOR_000000;
            break;
        case OCCButtonTypeRed:
            imageName = @"btn_bg_red";
            color=COLOR_FFFFFF;
            break;
        default:
            color=COLOR_FFFFFF;
            break;
    }
    
    UIImage *bgImage = [UIImage imageNamed:imageName];
    [btn setBackgroundImage:[bgImage stretchableImageWithLeftCapWidth:bgImage.size.width/2 topCapHeight:bgImage.size.height/2] forState:UIControlStateNormal];
    [btn setImage:[UIImage imageNamed:image] forState:UIControlStateNormal];
    [btn addTarget:target action:selector forControlEvents:UIControlEventTouchUpInside];
    [btn setTitleColor:color forState:UIControlStateNormal];
    [btn setTitleColor:color forState:UIControlStateHighlighted];
    btn.titleLabel.font = FONT_14;
    return btn;
}

+ (UIView *)nodataViewWithTip:(NSString*)text
{
    UIView *nodataView=[[UIView alloc]init];
    [nodataView setFrame:CGRectMake(0,0, SCREEN_WIDTH, SCREEN_HEIGHT)];
    
    UILabel *nodataLable = [[UILabel alloc]init];
    [nodataLable setTextColor:[UIColor lightGrayColor]];
    [nodataLable setBackgroundColor:[UIColor clearColor]];
    [nodataLable setText:text];
    [nodataLable setFont:FONT_20];
    [nodataLable setFrame:CGRectMake(0,0, SCREEN_WIDTH, 44)];
    [nodataLable setTextAlignment:NSTextAlignmentCenter];
    [nodataView addSubview:nodataLable];
    
    return nodataView;
}

+ (UIActivityIndicatorView *)loadingViewWithCenter:(CGPoint)point
{
    UIActivityIndicatorView *activityIndicatorView = [[UIActivityIndicatorView alloc]init];
    [activityIndicatorView setFrame:CGRectMake(0, 20.0f, 32.0f, 32.0f)];
    [activityIndicatorView setCenter:point];
    [activityIndicatorView setActivityIndicatorViewStyle: UIActivityIndicatorViewStyleWhiteLarge];
    [activityIndicatorView setHidesWhenStopped:YES];
    [activityIndicatorView setColor:[UIColor blackColor]];
    return activityIndicatorView;
}

#pragma mark -
#pragma mark TableView Cell BG
+ (UIView *)selectedCellBGViewWithType:(OCCCellSelectedBGType)cellType
{
    UIImageView *selectedImageView = [[UIImageView alloc] initWithFrame:CGRectMake(0, 0, SCREEN_WIDTH, HEADER_HEIGHT)];
    if (cellType == OCCCellSelectedBGTypeClassOne)
    {
        selectedImageView.backgroundColor = COLOR_CCB6A3;
    }
    else if (cellType == OCCCellSelectedBGTypeClassTwo)
    {
        selectedImageView.image = nil;
        selectedImageView.backgroundColor = COLOR_26221F;
    }
    else if (cellType == OCCCellSelectedBGTypeClassThree)
    {
        selectedImageView.backgroundColor = COLOR_CCB6A3;
    }
    else if (cellType == OCCCellSelectedBGTypeClassFour)
    {
        selectedImageView.backgroundColor = COLOR_594F47;
    }
    return selectedImageView;
}

+ (UIView *)cellNormalLineWithSuperFrame:(CGRect)frame
{
    UIImage *lineImage = [UIImage imageNamed:@"line_normal"];
    UIView *lineView = [[UIView alloc] initWithFrame:CGRectMake((frame.size.width - lineImage.size.width)/2, frame.size.height - 2, lineImage.size.width, 2)];
    lineView.backgroundColor = [UIColor colorWithPatternImage:lineImage];
    return lineView;
}

+ (UIView *)cellNaviLineWithSuperFrame:(CGRect)frame
{
    UIView *lineView = [[UIView alloc] initWithFrame:CGRectMake(0, frame.size.height - 1, frame.size.width, 1)];
    lineView.backgroundColor = [UIColor colorWithPatternImage:[UIImage imageNamed:@"line_navi"]];
    return lineView;
}

+ (UIImageView *)lineWithWithType:(OCCLineType)lineType
{
    UIImageView *lineImageView=[[UIImageView alloc]init];
    switch (lineType) {
        case OCCLineType1:
        {
            [lineImageView setImage:[UIImage imageNamed:@"line1"]];
            [lineImageView setHighlightedImage:[UIImage imageNamed:@"line1"]];
        }
            break;
        case OCCLineType2:
        {
            [lineImageView setImage:[UIImage imageNamed:@"line2"]];
            [lineImageView setHighlightedImage:[UIImage imageNamed:@"line2"]];
        }
            break;
        case OCCLineType3:
        {
            [lineImageView setImage:[UIImage imageNamed:@"line3"]];
            [lineImageView setHighlightedImage:[UIImage imageNamed:@"line3"]];
        }
            break;
        default:
            break;
    }
    
    return lineImageView;
}

#pragma mark -
#pragma mark æä»¶æä½
/******************************************************************************
 å½æ°åç§° : getFilePathWithFileName:
 å½æ°æè¿° : æ ¹æ®æä»¶åç§°è·åæä»¶documentè·¯å¾,å¦æå¤çº§éè¦ä¼ éä¸çº§æä»¶å¤¹åç§°
 è¾å¥åæ° : fileName:æä»¶åç§°.
 è¾åºåæ° : String æä»¶å®æ´è·¯å¾
 è¿åå¼ : String æä»¶å®æ´è·¯å¾
 å¤æ³¨ :
 æ·»å äºº : zhangss
 ******************************************************************************/
+ (NSString *)getFilePathWithFileName:(NSString *)fileName
{
    return [[NSHomeDirectory()stringByAppendingPathComponent:@"Documents"]stringByAppendingPathComponent:fileName];
}

/******************************************************************************
 å½æ°åç§° : addFolderToPath: withFolderName:
 å½æ°æè¿° : å¨ç®æ è·¯å¾ä¸åå»ºæä»¶å¤¹ ç®æ è·¯å¾ä¸ºç©ºæ¶ä¸ºé»è®¤Documentè·¯å¾
 è¾å¥åæ° : folderPath:ç®æ è·¯å¾(ä¼ ç©ºæ¶ä¸ºdocumentè·¯å¾ å¦åä¼ éDocumentçä¸ä¸çº§æä»¶è·¯å¾) folderName:æä»¶å¤¹åç§°
 è¾åºåæ° : æ 
 è¿åå¼ : BOOL æ¯å¦åå»ºæå
 å¤æ³¨ : 1.folderPathä¸ºç©º åå¨documentä¸åå»ºæä»¶å¤¹
       2.folderPathä¸ä¸ºç©º åå¨pahtä¸åå»ºæä»¶å¤¹ ä¾å¦ä¼ é document/fileåè¡¨ç¤ºå¨fileä¸
 æ·»å äºº : zhangss
 ******************************************************************************/
+ (BOOL)addFolderToPath:(NSString *)folderPath withFolderName:(NSString *)folderName
{
    BOOL isSuccess = NO;
    
    NSFileManager* fileManager = [NSFileManager defaultManager];
    BOOL isDirectory = YES;
    NSString *newPath = nil;
    if (folderPath == nil)
    {
        //æ²¡æç®æ è·¯å¾ åå»ºdocumentè·¯å¾ä¸çæä»¶å¤¹
        newPath = [CommonMethods getFilePathWithFileName:folderName];
    }
    else
    {
        //å¨docä¸åå»ºå¤çº§æä»¶å¤¹
        newPath = [folderPath stringByAppendingPathComponent:folderName];
    }

    if(![fileManager fileExistsAtPath:newPath isDirectory:&isDirectory])
    {
        NSError* error = nil;
        isSuccess = [fileManager createDirectoryAtPath:newPath  withIntermediateDirectories:YES attributes:nil error:&error];
        if (error)
        {
            NSLog(@"%@",error);
        }
    }
    return isSuccess;
}

/******************************************************************************
 å½æ°åç§° : getImageFilePathFromURL:
 å½æ°æè¿° : æ ¹æ®å¾ççURLå°å è¿æ»¤æç¹æ®å­ç¬¦ è·åå¾çæä»¶ååè·¯å¾
 è¾å¥åæ° : urlString å¾ççå°åURL
 è¾åºåæ° : NSString æä»¶è·¯å¾
 è¿åå¼ : æä»¶è·¯å¾
 å¤æ³¨ : 
 æ·»å äºº : zhangss
 ******************************************************************************/
+ (NSString *)getImageFilePathFromURL:(NSString *)urlString
{
    if (urlString == nil || [urlString length] == 0)
    {
        //éæ³URLå¤æ­
        return nil;
    }
    NSString *imageName = [NSString stringWithFormat:@"%@",urlString];
    imageName = [imageName stringByReplacingOccurrencesOfString:@"/" withString:@""];
    imageName = [imageName stringByReplacingOccurrencesOfString:@"?" withString:@""];
    imageName = [imageName stringByReplacingOccurrencesOfString:@"proxy" withString:@""];
    imageName = [imageName stringByReplacingOccurrencesOfString:@":" withString:@""];
    imageName = [imageName stringByReplacingOccurrencesOfString:@".jpg" withString:@""];
    imageName = [imageName stringByReplacingOccurrencesOfString:@".png" withString:@""];
    imageName = [imageName stringByReplacingOccurrencesOfString:@".gif" withString:@""];
    
    NSString *imagePath = [[CommonMethods getFilePathWithFileName:OCC_IMAGE_CACHE_FOLDER] stringByAppendingPathComponent:imageName];    
    return imagePath;
}

/******************************************************************************
 å½æ°åç§° : getDataCachePathWithFileName:
 å½æ°æè¿° : æ ¹æ®å¾ççURLå°å è¿æ»¤æç¹æ®å­ç¬¦ è·åå¾çæä»¶ååè·¯å¾
 è¾å¥åæ° : urlString å¾ççå°åURL
 è¾åºåæ° : NSString æä»¶è·¯å¾
 è¿åå¼ : æä»¶è·¯å¾
 å¤æ³¨ :
 æ·»å äºº : zhangss
 ******************************************************************************/
+ (NSString *)getDataCachePathWithFileName:(NSString *)fileName
{    
    NSString *imagePath = [[CommonMethods getFilePathWithFileName:OCC_DATA_CACHE_FOLDER] stringByAppendingPathComponent:fileName];
    return imagePath;
}

#pragma mark -
#pragma makr Default Image
//è·åé»è®¤å¾ç
+ (UIImage *)defaultImageWithType:(OCCDefaultImageType)type
{
    NSString *defaultImage = nil;
    switch (type)
    {
        case OCCDefaultImageTypeImage:
        {
            defaultImage = @"default_image_246";
            break;
        }
        case OCCDefaultImageTypePortrait:
        {
            defaultImage = @"default_head_96";
            break;
        }
        default:
        {
            defaultImage = @"default_image_246";
            break;
        }
    }
    return [UIImage imageNamed:defaultImage];
}

#pragma mark -
#pragma mark æä½ç­å¾åæç¤ºæ¡
static OCCWaitingView *waitingView = nil;
+ (void)showWaitView:(NSString *)showStr
{
    if (waitingView == nil)
    {
        waitingView = [[OCCWaitingView alloc] init];
    }
    [waitingView showWaitView:showStr];
}

+ (void)hideWaitView
{
    if (waitingView)
    {
        [waitingView hideWaitView];
    }
}

+ (void)showAutoDismissView:(NSString *)showStr inView:(UIView *)view
{
#ifdef NeedFailDialog
    if (waitingView == nil)
    {
        waitingView = [[OCCWaitingView alloc] init];
    }
    [waitingView showAutoDismissView:showStr inView:view];
#endif
}

+ (void)showErrorDialog:(NSString*)msg inView:(UIView*)view
{
#ifdef NeedFailDialog
    MBProgressHUD *HUD;
    if (view){
        HUD = [[MBProgressHUD alloc] initWithView:view];
        [view addSubview:HUD];
    }else{
        HUD = [[MBProgressHUD alloc] initWithWindow:[UIApplication sharedApplication].keyWindow];
        [[UIApplication sharedApplication].keyWindow addSubview:HUD];
    }
    
    //HUD.labelText=@"æç¤º";
    HUD.detailsLabelText = msg;
    HUD.mode = MBProgressHUDModeCustomView;
    HUD.yOffset=-80;
    HUD.customView = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@"fail"]];
    [HUD showAnimated:YES whileExecutingBlock:^{
        sleep(2);
    } completionBlock:^{
        [HUD removeFromSuperview];
    }];
#endif
}

+ (void)showSuccessDialog:(NSString*)msg inView:(UIView*)view
{
    MBProgressHUD *HUD;
    if (view){
        HUD = [[MBProgressHUD alloc] initWithView:view];
        [view addSubview:HUD];
    }else{
        HUD = [[MBProgressHUD alloc] initWithWindow:[UIApplication sharedApplication].keyWindow];
        [[UIApplication sharedApplication].keyWindow addSubview:HUD];
    }
    
    //HUD.labelText=@"æç¤º";
    HUD.detailsLabelText = msg;
    HUD.mode = MBProgressHUDModeCustomView;
    HUD.yOffset=-80;
    HUD.customView = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@"success"]];
    [HUD showAnimated:YES whileExecutingBlock:^{
        sleep(2);
    } completionBlock:^{
        [HUD removeFromSuperview];
    }];
}

+ (void)showFailDialog:(NSString*)msg inView:(UIView*)view
{
    MBProgressHUD *HUD;
    if (view){
        HUD = [[MBProgressHUD alloc] initWithView:view];
        [view addSubview:HUD];
    }else{
        HUD = [[MBProgressHUD alloc] initWithWindow:[UIApplication sharedApplication].keyWindow];
        [[UIApplication sharedApplication].keyWindow addSubview:HUD];
    }
    
    //HUD.labelText=@"æç¤º";
    HUD.detailsLabelText = msg;
    HUD.mode = MBProgressHUDModeCustomView;
    HUD.yOffset=-80;
    HUD.customView = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@"fail"]];
    [HUD showAnimated:YES whileExecutingBlock:^{
        sleep(2);
    } completionBlock:^{
        [HUD removeFromSuperview];
    }];
}

+ (void)showTextDialog:(NSString*)msg inView:(UIView*)view
{
    MBProgressHUD *HUD;
    if (view){
        HUD = [[MBProgressHUD alloc] initWithView:view];
        [view addSubview:HUD];
    }else{
        HUD = [[MBProgressHUD alloc] initWithWindow:[UIApplication sharedApplication].keyWindow];
        [[UIApplication sharedApplication].keyWindow addSubview:HUD];
    }
    
    //HUD.labelText=@"æç¤º";
    HUD.detailsLabelText = msg;
    HUD.mode = MBProgressHUDModeText;
    HUD.yOffset=-80;
    [HUD showAnimated:YES whileExecutingBlock:^{
        sleep(2);
    } completionBlock:^{
        [HUD removeFromSuperview];
    }];
}

#pragma mark -
#pragma mark å¬å±æ§å¶å¨
+ (void)pushShopViewControllerWithData:(NSDictionary *)data
{
    GoodsFilterLeftViewController *leftController=[[GoodsFilterLeftViewController alloc]init];
    GoodsFilterViewController *rightController=[[GoodsFilterViewController alloc]init];
    ShopViewController *centerController=[[ShopViewController alloc]init];
    [centerController setData:data];
    IIViewDeckController *deckController=[[IIViewDeckController alloc]init];
    deckController.leftController=leftController;
    deckController.centerController=centerController;
    deckController.rightController=rightController;
    deckController.leftSize = 54;
    deckController.rightSize = 54;
    deckController.openSlideAnimationDuration = 0.3f;
    deckController.closeSlideAnimationDuration = 0.3f;
    deckController.bounceOpenSideDurationFactor = 0.3f;
    AppDelegate *myDelegate = (AppDelegate *)[[UIApplication sharedApplication]delegate];
    [myDelegate.navigationController pushViewController:deckController animated:YES];
}

#pragma mark -
#pragma mark å­ç¬¦ä¸²è½¬æ¢ä¸ºJSON
+ (NSDictionary *)getJsonValueFromString:(NSString *)dataString
{
    NSRange dataStrRange = [dataString rangeOfString:@"data="];
    NSString *jsonStr = nil;
    if (dataStrRange.length > 0)
    {
        //è§£ælinkURLçDataé¨å
        jsonStr = [dataString substringFromIndex:dataStrRange.location + dataStrRange.length];
        jsonStr = [jsonStr stringByReplacingOccurrencesOfString:@"'" withString:@"\""];
    }
    else
    {
        jsonStr = dataString;
    }
    
    SBJsonParser *parser = [[SBJsonParser alloc] init];
    NSDictionary *jsonDic = [parser objectWithString:jsonStr];
    return jsonDic;
}


+ (float) heightForString:(NSString *)text andFont:(UIFont*)font andWidth:(float)width
{
    CGSize sizeToFit = [text sizeWithFont:font
                         constrainedToSize:CGSizeMake(width, CGFLOAT_MAX) lineBreakMode:UILineBreakModeWordWrap];
    return sizeToFit.height;
}

+ (NSString *)getOrderStatusbyId:(int)id
{
    switch(id){
        case 0:
            return @"ç­å¾ä¹°å®¶ä»æ¬¾";
            break;
        case 10:
            return @"ç­å¾åå®¶åè´§";
            break;
        case 20:
            return @"å·²æ£è´§";
            break;
        case 25:
            return @"ç¼ºè´§";
            break;
        case 30:
            return @"ç­å¾ä¹°å®¶ç¡®è®¤æ¶è´§";
            break;
        case 40:
            return @"ä¹°å®¶å·²æ¶å°è´§ï¼ç³è¯·éè´§";
            break;
        case 50:
            return @"ä¹°å®¶æªæ¶å°è´§,ç³è¯·éæ¬¾";
            break;
        case 60:
            return @"åå®¶æç»éæ¬¾ãéè´§";
            break;
        case 70:
            return @"åå®¶åæéè´§";
            break;
        case 80:
            return @"å·²éè´§";
            break;
        case 90:
            return @"éæ¬¾æå";
            break;
        case 100:
            return @"äº¤æå®æ";
            break;
        case 110:
            return @"äº¤æå³é­";
            break;
        case 120:
            return @"å·²è¯è®º";
            break;
        case 130:
            return @"äº¤æå³é­";
            break;
        case 140:
            return @"äº¤æå³é­";
            break;
        case 150:
            return @"äº¤æå³é­";
            break;
        default:
            return @"";
            break;
    }
    
    return @"";
}

+(BOOL)checkIsLogin
{
    if ([[Singleton sharedInstance]TGC]==nil||[[[Singleton sharedInstance]TGC]length]==0)
    {
        LoginViewController *viewController=[[LoginViewController alloc]init];
        UINavigationController *nav=[[UINavigationController alloc]initWithRootViewController:viewController];
        AppDelegate *myDelegate = (AppDelegate *)[[UIApplication sharedApplication]delegate];
        [myDelegate.navigationController presentModalViewController:nav animated:YES];
        return NO;
    }
    else
    {
        return YES;
    }
}

+(BOOL)onlycheckIsLogin
{
    if ([[Singleton sharedInstance]TGC]==nil||[[[Singleton sharedInstance]TGC]length]==0)
    {
        return NO;
    }
    else
    {
        return YES;
    }
}

//æ£æµçæ¬æ´æ°å¥å£
+(void)checkVersionWithTarget:(id)target andSlience:(BOOL)slience
{
    if (!slience)
    {
        [CommonMethods showWaitView:@"æ­£å¨æ£æµçæ¬,è¯·ç¨å..."];
    }
    
    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0),
                   ^{
                       Reachability *r = [Reachability reachabilityWithHostName:@"www.apple.com"];
                       NetworkStatus status= [r currentReachabilityStatus];
                       if (status==NotReachable)
                       {
                           if (!slience)
                           {
                               dispatch_async(dispatch_get_main_queue(),
                                              ^{
                                                  [CommonMethods hideWaitView];
                                                  [CommonMethods showTextDialog:@"ç½ç»æé,è¯·æ£æ¥æ¨çç½ç»æ¯å¦æ­£å¸¸" inView:nil];
                                              });
                           }
                       }
                       else
                       {
                           BOOL needUpdate=NO;
                           NSDictionary *data;
                           NSString *URL = APP_DOWNLOAD_URL;
                           NSMutableURLRequest *request = [[NSMutableURLRequest alloc]init];
                           [request setURL:[NSURL URLWithString:URL]];
                           [request setHTTPMethod:@"POST"];
                           NSHTTPURLResponse *urlResponse = nil;
                           NSError *error = nil;
                           NSData *recervedData = [NSURLConnection sendSynchronousRequest:request returningResponse:&urlResponse error:&error];
                           
                           NSString *results = [[NSString alloc] initWithBytes:[recervedData bytes] length:[recervedData length] encoding:NSUTF8StringEncoding];
                           NSDictionary *dic = [results JSONValue];
                           NSArray *infoArray = [dic objectForKey:@"results"];
                           if ([infoArray count])
                           {
                               float currentVersion=[[[[NSBundle mainBundle] infoDictionary] objectForKey:@"CFBundleVersion"]floatValue];
                               NSDictionary *releaseInfo = [infoArray objectAtIndex:0];
                               float lastVersion = [[releaseInfo objectForKey:@"version"]floatValue];
                               if (lastVersion>currentVersion)
                               {
                                   data=releaseInfo;
                                   NSString *trackViewURL = [releaseInfo objectForKey:@"trackViewUrl"];
                                   [[Singleton sharedInstance]setTrackViewURL:trackViewURL];
                                   needUpdate=YES;
                               }
                           }
                           
                           dispatch_async(dispatch_get_main_queue(),
                                          ^{
                                              [CommonMethods hideWaitView];
                                              if (needUpdate)
                                              {
                                                  //NSString *lastVersion = [data objectForKey:@"version"];
                                                  //NSString *releaseNotes=[data objectForKey:@"releaseNotes"];
                                                  UIAlertView * alertView = [[UIAlertView alloc] initWithTitle:@"æç¤º"
                                                                                                       message:@"æ£æµå°ææ°çæ¬,è¯·åæ¶æ´æ°"
                                                                                                      delegate:[[UIApplication sharedApplication]delegate]
                                                                                             cancelButtonTitle:@"ç«å³æ´æ°"
                                                                                             otherButtonTitles:nil];
                                                  [alertView setTag:AlertTagNewVersion];
                                                  [alertView show];
                                              }
                                              else if (!slience)
                                              {
                                                  [CommonMethods showTextDialog:@"å½åå·²ç»æ¯ææ°çæ¬" inView:nil];
                                              }
                                          });
                       }
                   });
}

+(void)alipay:(Product*)product
{
	/*
	 *åæ·çå¯ä¸çparnteråsellerã
	 */
    NSString *partner=product.partner;
    NSString *seller=product.seller;
    NSString *tradeNO=product.tradeNO;
    NSString *notifyURL=product.notifyURL;
    NSString *pvk=product.pvk;
	
	//partneråsellerè·åå¤±è´¥,æç¤º
	if ([partner length] == 0)
	{
		UIAlertView *alert = [[UIAlertView alloc] initWithTitle:@"æç¤º"
														message:@"ç¼ºå°partner"
													   delegate:nil
											  cancelButtonTitle:@"ç¡®å®"
											  otherButtonTitles:nil];
		[alert show];
		return;
	}
    
    if ([seller length] == 0)
	{
		UIAlertView *alert = [[UIAlertView alloc] initWithTitle:@"æç¤º"
														message:@"ç¼ºå°seller"
													   delegate:nil
											  cancelButtonTitle:@"ç¡®å®"
											  otherButtonTitles:nil];
		[alert show];
		return;
	}
    
    if ([tradeNO length] == 0)
	{
		UIAlertView *alert = [[UIAlertView alloc] initWithTitle:@"æç¤º"
														message:@"ç¼ºå°tradeNO"
													   delegate:nil
											  cancelButtonTitle:@"ç¡®å®"
											  otherButtonTitles:nil];
		[alert show];
		return;
	}
    
    if ([notifyURL length] == 0)
	{
		UIAlertView *alert = [[UIAlertView alloc] initWithTitle:@"æç¤º"
														message:@"ç¼ºå°notifyURL"
													   delegate:nil
											  cancelButtonTitle:@"ç¡®å®"
											  otherButtonTitles:nil];
		[alert show];
		return;
	}
    
    if ([pvk length] == 0)
	{
		UIAlertView *alert = [[UIAlertView alloc] initWithTitle:@"æç¤º"
														message:@"ç¼ºå°pvk"
													   delegate:nil
											  cancelButtonTitle:@"ç¡®å®"
											  otherButtonTitles:nil];
		[alert show];
		return;
	}
    
    //åºç¨æ³¨åscheme,å¨AlixPayDemo-Info.plistå®ä¹URL types,ç¨äºå¿«æ·æ¯ä»æååéæ°å¤èµ·åæ·åºç¨
	NSString *appScheme = @"plocc";
	
	//å°ååä¿¡æ¯èµäºAlixPayOrderçæååé
	AlixPayOrder *order = [[AlixPayOrder alloc] init];
	order.partner = partner;
	order.seller = seller;
    order.tradeNO=tradeNO; //è®¢åID
	order.productName = product.subject; //ååæ é¢
	order.productDescription = product.body; //ååæè¿°
	order.amount = product.amount; //ååä»·æ ¼
	order.notifyURL =  notifyURL; //åè°URL
	
	//å°ååä¿¡æ¯æ¼æ¥æå­ç¬¦ä¸²
	NSString *orderInfo = [order description];
	NSLog(@"orderInfo = %@",orderInfo);
	
	//è·åç§é¥å¹¶å°åæ·ä¿¡æ¯ç­¾å
    id<DataSigner> signer= CreateRSADataSigner(pvk);
    NSString *signedString = [signer signString:orderInfo];
    
    NSString *orderString = [NSString stringWithFormat:@"%@&sign=\"%@\"&sign_type=\"%@\"",
                             orderInfo,
                             signedString,
                             @"RSA"];
	
    [AlixLibService payOrder:orderString AndScheme:appScheme seletor:@selector(paymentResult:) target:[[UIApplication sharedApplication]delegate]];
}

+ (void) showTip:(NSString*)msg
{
    UIAlertView *alert = [[UIAlertView alloc]initWithTitle:@"æç¤º"
                                                   message:msg
                                                  delegate:nil
                                         cancelButtonTitle:@"ç¡®å®"
                                         otherButtonTitles:nil];
    
    [alert show];
}

+ (ASIFormDataRequest*) asiHttpRequestWithURL:(NSString*)str andData:(NSString*)reqdata  andDelegate:(id)delegate
{
    NSURL *url = [NSURL URLWithString:[str stringByAddingPercentEscapesUsingEncoding:NSUTF8StringEncoding]];
    NSLog(@"requesturl=%@?data=%@",url,reqdata);
    ASIFormDataRequest *request =[ASIFormDataRequest requestWithURL:url];
    [request setRequestMethod:@"POST"];
    [request setTimeOutSeconds:TIME_OUT_TIME_INTERVAL];
    [request setShouldAttemptPersistentConnection:NO];
    [request setPersistentConnectionTimeoutSeconds:KEEP_ALIVE_TIME_INTERVAL];
    [request setNumberOfTimesToRetryOnTimeout:2];
    [request setCachePolicy:ASIAskServerIfModifiedCachePolicy];
    [request setSecondsToCache:CACHE_TIMEOUT_INTERVAL];
    [request addRequestHeader:@"Content-Type" value:@"text/xml; charset=utf-8"];
    [request addRequestHeader:@"type" value:@"app"];
    [request addRequestHeader:@"tgc" value:[[Singleton sharedInstance]TGC]];
    [request addRequestHeader:@"mac" value:[OCCUtiil getWifiMac]];
    [request addRequestHeader:@"uid" value:[NSString stringWithFormat:@"%d",[[Singleton sharedInstance]userId]]];
    [request addRequestHeader:@"client" value:@"ios"];
    [request addRequestHeader:@"version" value:[[[NSBundle mainBundle] infoDictionary] objectForKey:(NSString *)kCFBundleVersionKey]];
    [request addRequestHeader:@"device" value:[OpenUDID value]];
    [request setPostValue:reqdata forKey:@"data"];
    [request setDelegate:delegate];
    [request startSynchronous];
    NSLog(@"server response:%@",[request responseString]);
    return request;
}

+ (void)loginWithUsername:(NSString*)username andPassword:(NSString*)password
{
    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0),
                   ^{
                       NSMutableDictionary *obj =[NSMutableDictionary dictionaryWithObjectsAndKeys:
                                                  [NSNumber numberWithInt:[[Singleton sharedInstance]mall]], @"mall",
                                                  [[Singleton sharedInstance]TGC], @"TGC",
                                                  username,@"loginname",
                                                  password,@"loginpwd",
                                                  nil];
                       
                       NSString *reqdata=[[[SBJsonWriter alloc] init]stringWithObject:obj];
                       
                       
                       dispatch_async(dispatch_get_main_queue(),
                                      ^{
                                          [CommonMethods showWaitView:@"æ­£å¨è¯·æ±ä¸­,è¯·ç¨å..."];
                                      });
                       
                       ASIFormDataRequest *request=[CommonMethods asiHttpRequestWithURL:login_URL andData:reqdata andDelegate:nil];
                       
                       dispatch_async(dispatch_get_main_queue(),
                                      ^{
                                          [CommonMethods hideWaitView];
                                      });
                       
                       NSError *error = [request error];
                       if (error)
                       {
                           NSLog(@"Failed %@ with code %d and with userInfo %@",
                                 [error domain],
                                 [error code],
                                 [error userInfo]);
                           
                           dispatch_async(dispatch_get_main_queue(),
                                          ^{
                                              [CommonMethods showFailDialog:@"ç½ç»å¼å¸¸,è¯·æ£æ¥æ¨çç½ç»è®¾ç½®!" inView:nil];
                                          });
                           return;
                       }
                       
                       SBJsonParser *jsonParser=[[SBJsonParser alloc] init];
                       NSDictionary *root = [jsonParser objectWithString:[request responseString]];
                       if (root==nil){
                           dispatch_async(dispatch_get_main_queue(),
                                          ^{
                                              [CommonMethods showFailDialog:@"æå¡å¨å¼å¸¸,è¯·éè¯!" inView:nil];
                                          });
                       }else if ([[root objectForKey:@"code"]intValue]==0){
                           dispatch_async(dispatch_get_main_queue(),
                                          ^{
                                              NSDictionary *data=[root objectForKey:@"data"];
                                              NSLog(@"login%@",data);
                                              [[Singleton sharedInstance] setUserNickname:[data objectForKey:@"nickname"]];
                                              [[Singleton sharedInstance] setUserName:[data objectForKey:@"username"]];
                                              [[Singleton sharedInstance] setUserEmail:[data objectForKey:@"email"]];
                                              [[Singleton sharedInstance] setUserMobile:[data objectForKey:@"mobile"]];
                                              [[Singleton sharedInstance] setTGC:[data objectForKey:@"TGC"]];
                                              [[Singleton sharedInstance] setUserId:[[data objectForKey:@"id"]intValue]];
                                              
                                              // ==================NSUserDefaults========================
                                              NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];
                                              [defaults setObject:username forKey:OCC_USER_NAME];
                                              [defaults setObject:password forKey:OCC_USER_PASSWORD];
                                              [defaults synchronize];
                                              
                                              [[NSNotificationCenter defaultCenter] postNotificationName:@"loginSuccessNotification" object:nil];
                                              
                                              [CommonMethods checkWifi];
                                          });
                       }else{
                           dispatch_async(dispatch_get_main_queue(),
                                          ^{
                                              [CommonMethods showFailDialog:[root objectForKey:@"msg"] inView:nil];
                                          });
                       }
                   });
}

+ (void)login
{
    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0),
                   ^{
                       NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];
                       NSString *username = (NSString *)[defaults objectForKey:OCC_USER_NAME];
                       NSString *userpassword = (NSString *)[defaults objectForKey:OCC_USER_PASSWORD];
                       if(username==nil || userpassword==nil){
                           return;
                       }
                       
                       NSMutableDictionary *obj =[NSMutableDictionary dictionaryWithObjectsAndKeys:
                                                  [NSNumber numberWithInt:[[Singleton sharedInstance]mall]], @"mall",
                                                  [[Singleton sharedInstance]TGC], @"TGC",
                                                  username,@"loginname",
                                                  userpassword,@"loginpwd",
                                                  nil];
                       
                       NSString *reqdata=[[[SBJsonWriter alloc] init]stringWithObject:obj];
                       
                       
                       ASIFormDataRequest *request=[CommonMethods asiHttpRequestWithURL:login_URL andData:reqdata andDelegate:nil];
                       
                       NSError *error = [request error];
                       if (error)
                       {
                           NSLog(@"Failed %@ with code %d and with userInfo %@",
                                 [error domain],
                                 [error code],
                                 [error userInfo]);
                           return;
                       }
                       
                       SBJsonParser *jsonParser=[[SBJsonParser alloc] init];
                       NSDictionary *root = [jsonParser objectWithString:[request responseString]];
                       if (root==nil){
                           
                       }else if ([[root objectForKey:@"code"]intValue]==0){
                           dispatch_async(dispatch_get_main_queue(),
                                          ^{
                                              NSDictionary *data=[root objectForKey:@"data"];
                                              NSLog(@"login%@",data);
                                              [[Singleton sharedInstance] setUserNickname:[data objectForKey:@"nickname"]];
                                              [[Singleton sharedInstance] setUserName:[data objectForKey:@"username"]];
                                              [[Singleton sharedInstance] setUserEmail:[data objectForKey:@"email"]];
                                              [[Singleton sharedInstance] setUserMobile:[data objectForKey:@"mobile"]];
                                              [[Singleton sharedInstance] setTGC:[data objectForKey:@"TGC"]];
                                              [[Singleton sharedInstance] setUserId:[[data objectForKey:@"id"]intValue]];
                                              
                                              [[NSNotificationCenter defaultCenter] postNotificationName:@"loginSuccessNotification"
                                                                                                  object:nil];
                                              
                                              [CommonMethods checkWifi];
                                          });
                       }else{
                           
                       }
                   });
}

+ (void)checkWifi
{
    NSString *ssid=[OCCUtiil getWifiSSID];
    if ([ssid isEqualToString:POWERLONG_WIFI_SSID])
    {
        BOOL isLogin=[CommonMethods onlycheckIsLogin];
        if (isLogin==YES)
        {
            [CommonMethods conntWifi];
        }
    }
}

+ (void)conntWifi
{
    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0),
                   ^{
                       NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];
                       NSString *username = (NSString *)[defaults objectForKey:OCC_USER_NAME];
                       NSString *userpassword = (NSString *)[defaults objectForKey:OCC_USER_PASSWORD];
                       if(username==nil || userpassword==nil)
                       {
                           return;
                       }
                       
                       NSString *mac=[OCCUtiil getWifiMac];
                       if(mac==nil || [mac length]==0)
                       {
                           return;
                       }
                       
                       NSDictionary *obj =[NSDictionary dictionaryWithObjectsAndKeys:
                                                  [NSNumber numberWithInt:[[Singleton sharedInstance]mall]],@"mall",
                                                  [[Singleton sharedInstance]TGC], @"TGC",
                                                  username,@"loginname",
                                                  userpassword,@"password",
                                                  [OCCUtiil getWifiIp],@"ip",
                                                  mac,@"mac",
                                                  [OCCUtiil getWifiSSID],@"ssid",
                                                  nil];
                       
                       NSString *reqdata=[[[SBJsonWriter alloc] init]stringWithObject:obj];
                       
                       NSString *wifiURL=[OCCUtiil getWifiFromMallData];
                       if (wifiURL!=nil&&[wifiURL length]>0)
                       {
                           ASIFormDataRequest *request=[CommonMethods asiHttpRequestWithURL:wifiURL andData:reqdata andDelegate:nil];
                       }
                   });
}

+ (NSString*)parseText:(NSString*)text fromHtmlString:(NSString*)str
{
    NSArray *arr=[str componentsSeparatedByString:@"&"];
    for (NSString *str in arr)
    {
        NSArray *list=[str componentsSeparatedByString:@"="];
        NSString *str0=[list objectAtIndex:0];
        NSString *str1=[list objectAtIndex:1];
        if ([str0 isEqualToString:text])
        {
            return str1;
        }
    }
    
    return @"";
}

+ (NSString*)encodeURL:(NSString *)string
{
    ASIFormDataRequest *formDataRequest = [ASIFormDataRequest requestWithURL:nil];
    NSString *encodedValue = [formDataRequest encodeURL:string];
    return encodedValue;
}

@end
